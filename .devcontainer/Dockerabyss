FROM postgres:15

# Install SSH server + tini
RUN apt-get update && \
    apt-get install -y openssh-server tini && \
    mkdir -p /var/run/sshd /root/.ssh

COPY .key /root/.ssh/authorized_keys
RUN chmod 600 /root/.ssh/authorized_keys

COPY entrypoint.sh /usr/local/bin/entrypoint.sh
RUN chmod +x /usr/local/bin/entrypoint.sh

EXPOSE 22 5432

ENTRYPOINT ["/usr/bin/tini-static", "--"]
CMD ["/usr/local/bin/entrypoint.sh"]
